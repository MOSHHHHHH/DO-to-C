<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×ª×¨×’×•×œ ×”××¨×ª ×ª×•×•×™×</title>
    <!-- ×˜×¢×™× ×ª Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ×”×’×“×¨×ª ×’×•×¤×Ÿ ××™× ×˜×¨ ×›×‘×¨×™×¨×ª ××—×“×œ */
        @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700;900&display=swap');
        body {
            font-family: 'Heebo', sans-serif;
            background: linear-gradient(135deg, #f0f4f8 0%, #e0e7ee 100%);
        }
        .card {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }
        .button-primary {
            transition: all 0.2s ease-in-out;
        }
        .button-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(49, 130, 206, 0.4);
        }
        .progress-note {
            transition: all 0.3s ease-in-out;
            cursor: default;
        }
        .current-note {
            animation: pulse 1.5s infinite alternate;
        }
        @keyframes pulse {
            from {
                transform: scale(1.05);
                box-shadow: 0 0 10px rgba(49, 130, 206, 0.7);
            }
            to {
                transform: scale(1.1);
                box-shadow: 0 0 20px rgba(49, 130, 206, 0.9);
            }
        }
        .answer-option {
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
        }
        .answer-option:hover {
            background-color: #f0f4f8;
            transform: translateY(-1px);
        }
        .correct-answer {
            background-color: #38a169 !important; /* ×™×¨×•×§ */
            color: white;
            font-weight: bold;
        }
        .error-message {
            animation: shake 0.5s;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-10px); }
            40%, 80% { transform: translateX(10px); }
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div id="app" class="w-full max-w-2xl bg-white card rounded-2xl p-6 md:p-10">
        <!-- ×”×ª×•×›×Ÿ ×™×™×˜×¢×Ÿ ×›××Ÿ ×‘×××¦×¢×•×ª JavaScript -->
    </div>

    <script>
        // ×”×’×“×¨×•×ª ×‘×¡×™×¡×™×•×ª
        const NOTES = [
            { hebrew: '×“×•', english: 'C' },
            { hebrew: '×¨×”', english: 'D' },
            { hebrew: '××™', english: 'E' },
            { hebrew: '×¤×”', english: 'F' },
            { hebrew: '×¡×•×œ', english: 'G' },
            { hebrew: '×œ×”', english: 'A' },
            { hebrew: '×¡×™', english: 'B' },
        ];
        const QUIZ_LENGTH = 10;
        const HIGH_SCORES_KEY = 'noteConversionHighScores';
        const ERROR_TIMEOUT_MS = 2000;

        // ××©×ª× ×™ ××¦×‘
        let appState = {
            view: 'home', // 'home', 'quiz', 'scores'
            mode: null,   // 'hebrew-english', 'english-hebrew', 'mixed'
            quizData: [],
            currentQuestionIndex: 0,
            startTime: null,
            timerInterval: null,
            elapsedTime: 0,
            userId: 'user-001', // ××–×”×” ××©×ª××© ×§×‘×•×¢ ×œ×¦×•×¨×š ×”×“×’××”
            isHandlingInput: false // ×œ×× ×™×¢×ª ×›×¤×œ ×§×œ×™×§×™×/×”×§×©×•×ª ×‘×–××Ÿ ×‘×“×™×§×”
        };

        const appContainer = document.getElementById('app');

        // --- ×›×œ×™ ×¢×–×¨ ---

        /**
         * ×˜×¢×™× ×ª ×”×©×™××™× ×”×©××•×¨×™× ×-localStorage
         * @returns {Array<Object>} ×¨×©×™××ª ×”×©×™××™× ×××•×™× ×ª
         */
        function loadHighScores() {
            try {
                const scores = JSON.parse(localStorage.getItem(HIGH_SCORES_KEY)) || [];
                // ×•×“× ×©×”×©×™××™× ×××•×™× ×™× ×ª××™×“ ××”××”×™×¨ ×œ××™×˜×™
                return scores.sort((a, b) => a.time - b.time).slice(0, 5);
            } catch (e) {
                console.error("×©×’×™××” ×‘×˜×¢×™× ×ª ×”×©×™××™× ×-localStorage:", e);
                return [];
            }
        }

        /**
         * ×©××™×¨×ª ×”×©×™× ×”× ×•×›×—×™ ×× ×”×•× × ×›× ×¡ ×œ×˜×•×¤ 5
         * @param {number} time - ×”×–××Ÿ ×©× ××“×“ ×‘×©× ×™×•×ª
         * @returns {boolean} ×”×× ×”×•×©×’ ×©×™× ×—×“×© (× ×›× ×¡ ×œ×˜×•×¤ 5)
         */
        function saveHighScore(time) {
            const scores = loadHighScores();
            const newScore = {
                id: crypto.randomUUID(),
                time: time,
                date: new Date().toISOString(),
                mode: appState.mode,
            };

            if (scores.length < 5 || time < scores[scores.length - 1].time) {
                scores.push(newScore);
                const updatedScores = scores.sort((a, b) => a.time - b.time).slice(0, 5);
                localStorage.setItem(HIGH_SCORES_KEY, JSON.stringify(updatedScores));
                return true;
            }
            return false;
        }
        
        /**
         * ×¤×•×¨××˜ ×–××Ÿ s.ms
         * @param {number} totalSeconds - ×”×–××Ÿ ×”×›×•×œ×œ ×‘×©× ×™×•×ª
         * @returns {string} ××—×¨×•×–×ª ×–××Ÿ ×‘×¤×•×¨××˜ s.ms
         */
        function formatTime(totalSeconds) {
            const seconds = Math.floor(totalSeconds);
            const milliseconds = Math.round((totalSeconds - seconds) * 1000);
            return `${seconds}.${String(milliseconds).padStart(3, '0')} ×©× ×™×•×ª`;
        }

        /**
         * ×‘×—×™×¨×ª ××™×‘×¨ ××§×¨××™ ×××¢×¨×š
         * @param {Array<any>} arr - ×”××¢×¨×š
         * @returns {any} ××™×‘×¨ ××§×¨××™
         */
        function getRandomElement(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        // --- ×œ×•×’×™×§×ª ×”××‘×—×Ÿ ---

        /**
         * ×™×¦×™×¨×ª ××¢×¨×š ×©××œ×•×ª ×—×“×© ×¢×‘×•×¨ ××¦×‘ × ×ª×•×Ÿ
         */
        function generateQuizData() {
            appState.quizData = [];
            const availableNotes = [...NOTES]; // ×”×¢×ª×§ ×©×œ ××¢×¨×š ×”×ª×•×•×™×
            const totalQuestions = Math.min(QUIZ_LENGTH, availableNotes.length);

            // ×‘×—×™×¨×ª ×”×ª×•×•×™× ×œ×©××œ×•×ª ×‘××•×¤×Ÿ ××§×¨××™ ×•×œ×œ× ×—×–×¨×•×ª
            const selectedNotes = [];
            while (selectedNotes.length < totalQuestions) {
                const randomIndex = Math.floor(Math.random() * availableNotes.length);
                selectedNotes.push(availableNotes.splice(randomIndex, 1)[0]);
            }

            selectedNotes.forEach(correctNote => {
                let source, targetKey, targetValue;

                // ×§×‘×™×¢×ª ×›×™×•×•×Ÿ ×”×©××œ×”
                let isHebrewToEnglish;
                if (appState.mode === 'hebrew-english') {
                    isHebrewToEnglish = true;
                } else if (appState.mode === 'english-hebrew') {
                    isHebrewToEnglish = false;
                } else { // 'mixed'
                    isHebrewToEnglish = Math.random() < 0.5;
                }

                if (isHebrewToEnglish) {
                    source = correctNote.hebrew;
                    targetKey = 'english';
                    targetValue = correctNote.english;
                } else {
                    source = correctNote.english;
                    targetKey = 'hebrew';
                    targetValue = correctNote.hebrew;
                }

                // ×™×¦×™×¨×ª ×ª×©×•×‘×•×ª ×¤×•×˜× ×¦×™××œ×™×•×ª
                let options = [{ value: targetValue, isCorrect: true }];

                // ×‘×—×™×¨×ª 2 ×ª×©×•×‘×•×ª ×©×’×•×™×•×ª
                const allPossibleIncorrect = NOTES
                    .filter(n => n[targetKey] !== targetValue)
                    .map(n => n[targetKey]);
                
                // ×©×™××•×© ×‘-Set ×›×“×™ ×œ×”×‘×˜×™×— ××§×¨××™×•×ª ×•×œ×œ× ×›×¤×™×œ×•×™×•×ª
                const incorrectOptions = new Set();
                while (incorrectOptions.size < 2 && allPossibleIncorrect.length > 0) {
                    const randomIndex = Math.floor(Math.random() * allPossibleIncorrect.length);
                    incorrectOptions.add(allPossibleIncorrect.splice(randomIndex, 1)[0]);
                }

                incorrectOptions.forEach(val => options.push({ value: val, isCorrect: false }));

                // ×¢×¨×‘×•×‘ ×”×ª×©×•×‘×•×ª
                options.sort(() => Math.random() - 0.5);

                appState.quizData.push({
                    source: source,
                    targetValue: targetValue,
                    targetKey: targetKey,
                    options: options,
                    isCorrect: false
                });
            });
        }

        /**
         * ××ª×—×•×œ ×”××‘×—×Ÿ
         * @param {string} mode - ××¦×‘ ×”××‘×—×Ÿ ×©× ×‘×—×¨
         */
        function startQuiz(mode) {
            appState.mode = mode;
            appState.currentQuestionIndex = 0;
            appState.isHandlingInput = false;
            generateQuizData();
            appState.startTime = performance.now();
            startTimer();
            appState.view = 'quiz';
            renderApp();
            
            // ×”×•×¡×¤×ª ×”××–× ×” ×œ××§×©×™× ×¨×§ ×‘×“×£ ×”××‘×—×Ÿ
            document.addEventListener('keydown', handleKeyPress);
        }

        /**
         * ××¢×‘×¨ ×œ×©××œ×” ×”×‘××”
         */
        function goToNextQuestion() {
            if (appState.currentQuestionIndex < QUIZ_LENGTH - 1) {
                appState.currentQuestionIndex++;
                renderApp();
            } else {
                completeQuiz();
            }
        }

        /**
         * ×¡×™×•× ×”××‘×—×Ÿ
         */
        function completeQuiz() {
            stopTimer();
            document.removeEventListener('keydown', handleKeyPress);
            const endTime = performance.now();
            appState.elapsedTime = (endTime - appState.startTime) / 1000;
            appState.isNewHighScore = saveHighScore(appState.elapsedTime);
            appState.view = 'scores';
            renderApp();
        }

        /**
         * ×‘×“×™×§×ª ×ª×©×•×‘×” ×©× ×‘×—×¨×”
         * @param {string} selectedValue - ×”×¢×¨×š ×©× ×‘×—×¨
         */
        function checkAnswer(selectedValue) {
            if (appState.isHandlingInput) return;
            appState.isHandlingInput = true;

            const currentQuestion = appState.quizData[appState.currentQuestionIndex];
            const isCorrect = selectedValue === currentQuestion.targetValue;
            
            const optionsContainer = document.getElementById('options-container');

            if (isCorrect) {
                // ×¡×™××•×Ÿ ×™×¨×•×§ ×•×”××©×š
                currentQuestion.isCorrect = true;
                const selectedElement = optionsContainer.querySelector(`[data-value="${selectedValue}"]`);
                if (selectedElement) {
                    selectedElement.classList.remove('bg-white', 'hover:bg-gray-100');
                    selectedElement.classList.add('bg-green-500', 'text-white');
                }
                
                setTimeout(() => {
                    appState.isHandlingInput = false;
                    goToNextQuestion();
                }, 300);

            } else {
                // ×¡×™××•×Ÿ ××“×•× ×•×”×•×“×¢×ª ×©×’×™××”
                const selectedElement = optionsContainer.querySelector(`[data-value="${selectedValue}"]`);
                const correctElement = optionsContainer.querySelector(`[data-value="${currentQuestion.targetValue}"]`);
                
                if (selectedElement) {
                    selectedElement.classList.add('bg-red-500', 'text-white', 'error-message');
                }
                if (correctElement) {
                    correctElement.classList.add('bg-green-500', 'text-white');
                }
                
                const messageElement = document.getElementById('quiz-message');
                if (messageElement) {
                    messageElement.textContent = '×˜×¢×•×ª, ××ª×—×™×œ×™× ××”×ª×—×œ×”...';
                    messageElement.classList.remove('text-gray-600', 'opacity-0');
                    messageElement.classList.add('text-red-600', 'font-bold');
                }

                stopTimer();
                
                // ××™×¤×•×¡ ×•×”×ª×—×œ×” ××—×“×© ×œ××—×¨ ×”×©×”×™×™×”
                setTimeout(() => {
                    appState.isHandlingInput = false;
                    startQuiz(appState.mode); // ××ª×—×™×œ ××—×“×© ×‘××•×ª×• ××¦×‘
                }, ERROR_TIMEOUT_MS);
            }
        }

        /**
         * ×˜×™×¤×•×œ ×‘×§×œ×™×˜×•×ª ××§×œ×“×ª 1, 2, 3
         * @param {KeyboardEvent} event 
         */
        function handleKeyPress(event) {
            if (appState.view !== 'quiz' || appState.isHandlingInput) return;
            
            let selectedOptionIndex = -1;
            if (event.key === '1') selectedOptionIndex = 0;
            else if (event.key === '2') selectedOptionIndex = 1;
            else if (event.key === '3') selectedOptionIndex = 2;

            if (selectedOptionIndex !== -1) {
                const currentQuestion = appState.quizData[appState.currentQuestionIndex];
                if (currentQuestion.options[selectedOptionIndex]) {
                    checkAnswer(currentQuestion.options[selectedOptionIndex].value);
                }
            }
        }
        
        // --- ×œ×•×’×™×§×ª ×˜×™×™××¨ ---

        /**
         * ×”×¤×¢×œ×ª ×˜×™×™××¨
         */
        function startTimer() {
            if (appState.timerInterval) clearInterval(appState.timerInterval);
            
            const timerElement = document.getElementById('timer-display');
            if (!timerElement) return;

            // ×¢×“×›×•×Ÿ ×”×˜×™×™××¨ ×›×œ 50ms (×œ×¦×•×¨×š ×”×¦×’×ª ××™×œ×™×©× ×™×•×ª)
            appState.timerInterval = setInterval(() => {
                const elapsed = (performance.now() - appState.startTime) / 1000;
                appState.elapsedTime = elapsed;
                if (timerElement) {
                     timerElement.textContent = `×–××Ÿ: ${formatTime(elapsed)}`;
                }
            }, 50);
        }

        /**
         * ×¢×¦×™×¨×ª ×˜×™×™××¨
         */
        function stopTimer() {
            if (appState.timerInterval) {
                clearInterval(appState.timerInterval);
                appState.timerInterval = null;
            }
        }


        // --- ×¨×›×™×‘×™ ×”×¦×’×” (Rendering) ---

        /**
         * ×”×¦×’×ª ×“×£ ×”×‘×™×ª (×‘×—×™×¨×ª ××¦×‘)
         */
        function renderHome() {
            appContainer.innerHTML = `
                <h1 class="text-3xl font-extrabold text-gray-800 mb-6 text-center">×ª×¨×’×•×œ ×”××¨×ª ×ª×•×•×™×</h1>
                <p class="text-gray-600 mb-8 text-center">×‘×—×¨ ××ª ×›×™×•×•×Ÿ ×”×ª×¨×’×•×œ:</p>
                <div class="space-y-4">
                    <button onclick="startQuiz('hebrew-english')" class="button-primary w-full p-4 text-lg font-bold bg-blue-500 text-white rounded-xl shadow-md hover:bg-blue-600 transition duration-150 ease-in-out transform hover:scale-[1.01]">
                        ×¢×‘×¨×™ (×“×•, ×¨×”, ××™) â† ×× ×’×œ×™ (C, D, E)
                    </button>
                    <button onclick="startQuiz('english-hebrew')" class="button-primary w-full p-4 text-lg font-bold bg-blue-500 text-white rounded-xl shadow-md hover:bg-blue-600 transition duration-150 ease-in-out transform hover:scale-[1.01]">
                        ×× ×’×œ×™ (C, D, E) â† ×¢×‘×¨×™ (×“×•, ×¨×”, ××™)
                    </button>
                    <button onclick="startQuiz('mixed')" class="button-primary w-full p-4 text-lg font-bold bg-blue-500 text-white rounded-xl shadow-md hover:bg-blue-600 transition duration-150 ease-in-out transform hover:scale-[1.01]">
                        ×©× ×™×”× (××¢×•×¨×‘)
                    </button>
                </div>
            `;
        }

        /**
         * ×”×¦×’×ª ×“×£ ×”××‘×—×Ÿ
         */
        function renderQuiz() {
            const currentQuestion = appState.quizData[appState.currentQuestionIndex];

            // 1. ×¨×›×™×‘ ××¦×™×’ ×”×ª×•×•×™× (Progress Tracker)
            const notesProgressHtml = appState.quizData.map((q, index) => {
                let classes = 'progress-note w-1/10 flex-shrink-0 mx-0.5 p-2 rounded-lg text-center font-bold border border-gray-300 transition-all duration-300 ease-in-out';
                
                if (index === appState.currentQuestionIndex) {
                    classes += ' bg-blue-100 text-blue-800 text-xl current-note shadow-lg';
                } else if (q.isCorrect) {
                    classes += ' bg-green-500 text-white opacity-70';
                } else {
                    classes += ' bg-gray-100 text-gray-700 text-sm opacity-50';
                }

                return `<div class="${classes}" style="width: calc(100% / ${QUIZ_LENGTH} - 4px);">${q.source}</div>`;
            }).join('');


            // 2. ×›×•×ª×¨×ª ×”×©××œ×”
            const targetLanguage = currentQuestion.targetKey === 'english' ? '×× ×’×œ×™×ª' : '×¢×‘×¨×™×ª';
            const sourceLanguage = currentQuestion.targetKey === 'english' ? '×¢×‘×¨×™×ª' : '×× ×’×œ×™×ª';
            const questionTitle = `××™×š ××•××¨×™× ××ª ×”×ª×• <span class="text-blue-600 font-extrabold text-4xl">${currentQuestion.source}</span> ×‘${targetLanguage}?`;
            
            // 3. ×¨×›×™×‘ ××¤×©×¨×•×™×•×ª ×”×ª×©×•×‘×”
            const optionsHtml = currentQuestion.options.map((option, index) => {
                // ×”×•×¡×¤×ª ×¡×™××•×Ÿ ×”××§×© ×œ×›×œ ×ª×©×•×‘×”
                const keyLabel = index + 1;
                return `
                    <div id="option-${index}" data-value="${option.value}" onclick="checkAnswer('${option.value}')" class="answer-option w-full p-4 bg-white rounded-xl shadow-md text-center text-xl font-semibold border-2 border-gray-200 hover:border-blue-400 transition duration-150 ease-in-out flex items-center justify-start">
                        <span class="ml-4 p-2 bg-gray-200 rounded-full font-bold text-gray-700 text-sm w-8 h-8 flex items-center justify-center">${keyLabel}</span>
                        <span>${option.value}</span>
                    </div>
                `;
            }).join('');


            appContainer.innerHTML = `
                <!-- ×˜×™×™××¨ -->
                <div id="timer-display" class="text-center text-2xl font-mono text-gray-700 mb-6">×–××Ÿ: 0.000 ×©× ×™×•×ª</div>
                
                <!-- ×¨×¦×•×¢×ª ×”×ª×§×“××•×ª -->
                <div class="flex flex-row-reverse justify-between items-center bg-gray-200 p-2 rounded-xl mb-8 overflow-hidden shadow-inner">
                    ${notesProgressHtml}
                </div>

                <!-- ×ª×•×›×Ÿ ×”×©××œ×” -->
                <div class="text-center mb-10 p-6 bg-blue-50 rounded-xl border border-blue-200">
                    <p class="text-lg text-gray-700 mb-4">×©××œ×” ${appState.currentQuestionIndex + 1} ××ª×•×š ${QUIZ_LENGTH}</p>
                    <p class="text-2xl font-semibold text-gray-800">${questionTitle}</p>
                </div>
                
                <!-- ×”×•×“×¢×•×ª ××¢×¨×›×ª -->
                <div id="quiz-message" class="text-center text-xl h-8 mb-6 text-gray-600 opacity-0 transition-opacity"></div>

                <!-- ××¤×©×¨×•×™×•×ª ×ª×©×•×‘×” -->
                <div id="options-container" class="space-y-4">
                    ${optionsHtml}
                </div>
                
                <p class="text-center text-sm text-gray-500 mt-6">× ×™×ª×Ÿ ×œ×”×§×™×© ×¢×œ ××§×©×™× 1, 2, ××• 3 ×œ×‘×—×™×¨×” ××”×™×¨×”.</p>
            `;
            // ×”×¤×¢×œ×ª ×”×˜×™×™××¨ ××—×“×© ×‘××™×“×” ×•×œ× ×¤×¢×™×œ (×œ××©×œ ×œ××—×¨ ×©×’×™××”)
            if (!appState.timerInterval) startTimer();
        }

        /**
         * ×”×¦×’×ª ×“×£ ×”×©×™××™×
         */
        function renderHighScores() {
            const scores = loadHighScores();
            const currentModeName = {
                'hebrew-english': '×¢×‘×¨×™ â† ×× ×’×œ×™',
                'english-hebrew': '×× ×’×œ×™ â† ×¢×‘×¨×™',
                'mixed': '××¢×•×¨×‘'
            }[appState.mode] || '×œ× ×™×“×•×¢';

            // ×˜×‘×œ×ª ×”×©×™××™×
            let scoresHtml = '';
            if (scores.length > 0) {
                 scoresHtml = scores.map((score, index) => {
                    // ×¡×™××•×Ÿ ×”×©×™× ×”× ×•×›×—×™ ×‘×”×“×’×©×”
                    const isCurrentScore = score.id === appState.isNewHighScore ? 'bg-yellow-100 font-bold' : 'bg-white';
                    
                    // ×¤×•×¨××˜ ×ª××¨×™×š × ×§×™
                    const date = new Date(score.date).toLocaleDateString('he-IL', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });

                    return `
                        <tr class="${isCurrentScore} border-b border-gray-100">
                            <td class="px-6 py-3 whitespace-nowrap text-lg text-gray-900">${index + 1}.</td>
                            <td class="px-6 py-3 whitespace-nowrap text-lg text-blue-600 font-mono">${formatTime(score.time)}</td>
                            <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-500">${currentModeName}</td>
                            <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-500">${date}</td>
                        </tr>
                    `;
                }).join('');
            } else {
                scoresHtml = `<tr><td colspan="4" class="py-4 text-center text-gray-500">×¢×“×™×™×Ÿ ××™×Ÿ ×©×™××™× ×©××•×¨×™×...</td></tr>`;
            }
            
            // ×”×•×“×¢×” ×¢×œ ×©×™× ××™×©×™
            let achievementMessage = '';
            if (appState.isNewHighScore) {
                achievementMessage = `
                    <div class="bg-yellow-100 border-r-4 border-yellow-500 text-yellow-800 p-4 rounded-lg mb-6 shadow-md" role="alert">
                        <p class="font-bold text-xl">ğŸ‰ ×©×™× ×—×“×©! ğŸ‰</p>
                        <p class="text-lg">×”×ª×•×¦××” ×©×œ×š × ×›× ×¡×” ×œ×—××™×©×™×™×” ×”×¤×•×ª×—×ª!</p>
                    </div>
                `;
            }

            appContainer.innerHTML = `
                <h1 class="text-3xl font-extrabold text-gray-800 mb-2 text-center">××‘×—×Ÿ ×”×•×©×œ×!</h1>
                <p class="text-4xl font-extrabold text-blue-600 mb-6 text-center">×–××Ÿ ×¡×™×•×: ${formatTime(appState.elapsedTime)}</p>
                
                ${achievementMessage}

                <h2 class="text-2xl font-bold text-gray-700 mt-8 mb-4 border-b pb-2">×œ×•×— ×”×©×™××™× (×˜×•×¤ 5)</h2>
                
                <div class="overflow-x-auto bg-gray-50 rounded-xl shadow-inner">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-200">
                            <tr>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">××§×•×</th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">×–××Ÿ</th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">××¦×‘</th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">×ª××¨×™×š</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                            ${scoresHtml}
                        </tbody>
                    </table>
                </div>

                <!-- ×›×¤×ª×•×¨×™ × ×™×•×•×˜ -->
                <div class="mt-8 space-y-4 md:space-y-0 md:flex md:space-x-4 md:space-x-reverse">
                    <button onclick="startQuiz(appState.mode)" class="button-primary flex-1 p-4 text-lg font-bold bg-green-500 text-white rounded-xl shadow-md hover:bg-green-600 transition duration-150 ease-in-out transform hover:scale-[1.01]">
                        ×—×–×¨×” ×œ××‘×—×Ÿ (×”×ª×—×œ×” ×—×“×©×”)
                    </button>
                    <button onclick="changeView('home')" class="button-primary flex-1 p-4 text-lg font-bold bg-gray-500 text-white rounded-xl shadow-md hover:bg-gray-600 transition duration-150 ease-in-out transform hover:scale-[1.01]">
                        ×—×–×•×¨ ×œ×“×£ ×”×‘×™×ª
                    </button>
                </div>
            `;
        }

        /**
         * ×©×™× ×•×™ ×ª×¦×•×’×”
         * @param {string} view - ×©× ×”×ª×¦×•×’×” ('home', 'quiz', 'scores')
         */
        function changeView(view) {
            appState.view = view;
            if (view !== 'quiz') {
                 stopTimer();
                 document.removeEventListener('keydown', handleKeyPress);
            }
            renderApp();
        }

        /**
         * ×”×¤×•× ×§×¦×™×” ×”×¨××©×™×ª ×œ×¨×™× ×“×•×¨ ×”××¤×œ×™×§×¦×™×”
         */
        function renderApp() {
            if (appState.view === 'home') {
                renderHome();
            } else if (appState.view === 'quiz') {
                renderQuiz();
            } else if (appState.view === 'scores') {
                renderHighScores();
            }
        }

        // --- ××ª×—×•×œ ---

        // ×—×©×™×¤×ª ×¤×•× ×§×¦×™×•×ª ×’×œ×•×‘×œ×™×•×ª ×œ×©×™××•×© ×‘-onclick
        window.startQuiz = startQuiz;
        window.checkAnswer = checkAnswer;
        window.changeView = changeView;

        // ××ª×—×•×œ ×¨××©×•× ×™ - ×˜×¢×Ÿ ×“×£ ×”×‘×™×ª
        document.addEventListener('DOMContentLoaded', () => {
            renderApp();
        });

    </script>
</body>
</html>
